))
combined_shares <- bind_rows(combined_shares, observations_row)
View(combined_shares)
shares_levada <- calculate_shares(levada_omnibus, "Levada")
shares_survey_march <- calculate_shares(survey_march, "Q. March 2024")
shares_survey_feb <- calculate_shares(survey_feb, "Q. February 2024")
shares_survey_aug <- calculate_shares(survey_aug, "Q. August 2023")
shares_survey_july <- calculate_shares(survey_july, "Q. July 2024")
shares_survey_sept <- calculate_shares(survey_sept, "Q. September 2024")
combined_shares <- bind_rows(shares_levada,
shares_survey_aug,
shares_survey_feb,
shares_survey_march,
shares_survey_july,
shares_survey_sept) %>%
pivot_wider(names_from = Survey, values_from = Share) %>%
mutate(Variable = case_when(
Variable == "age_group" ~ "Age", # improve visibility
Variable == "gender" ~ "Gender",
Variable == "university_education" ~ "Education",
TRUE ~ Variable # default case to leave the variable name as it is
))
n_levada <- as.integer(nrow(levada_omnibus))
n_march <- as.integer(nrow(survey_march))
n_feb <- as.integer(nrow(survey_feb))
n_aug <- as.integer(nrow(survey_aug))
n_july <- as.integer(nrow(survey_july))
n_sept <- as.integer(nrow(survey_sept))
# observations_row <- tibble(
#   Variable = "Number of Observations",
#   `Values` = "",
#   `Levada` = n_levada,
#   `Q. August 2023` = n_aug,
#   `Q. February 2024` = n_feb,
#   `Q. March 2024` = n_march,
#   `Q. July 2024` = n_july,
#   `Q. September 2024` = n_sept
# )
#
# combined_shares <- bind_rows(combined_shares, observations_row)
#
#
# Modify column names to include number of observations
colnames(combined_shares) <- c(
"Variable",
paste0("Levada (N=", n_levada, ")"),
paste0("Q. August 23 (N=", n_aug, ")"),
paste0("Q. February 24 (N=", n_feb, ")"),
paste0("Q. March 24 (N=", n_march, ")"),
paste0("Q. July 24 (N=", n_july, ")"),
paste0("Q. September 24 (N=", n_sept, ")")
)
# Display the table with the modified column names
kable(combined_shares, caption = "Comparison of Category Shares by Variable\\label{tab:omnibus_shares}",
align = "c",
format = "markdown")
kable(combined_shares, caption = "Comparison of Category Shares by Variable\\label{tab:omnibus_shares}",
align = "c",
format = "markdown")
# Modify column names to include number of observations
colnames(combined_shares) <- c(
"Variable",
"Values",
paste0("Levada (N=", n_levada, ")"),
paste0("Q. August 23 (N=", n_aug, ")"),
paste0("Q. February 24 (N=", n_feb, ")"),
paste0("Q. March 24 (N=", n_march, ")"),
paste0("Q. July 24 (N=", n_july, ")"),
paste0("Q. September 24 (N=", n_sept, ")")
)
shares_levada <- calculate_shares(levada_omnibus, "Levada")
shares_survey_march <- calculate_shares(survey_march, "Q. March 2024")
shares_survey_feb <- calculate_shares(survey_feb, "Q. February 2024")
shares_survey_aug <- calculate_shares(survey_aug, "Q. August 2023")
shares_survey_july <- calculate_shares(survey_july, "Q. July 2024")
shares_survey_sept <- calculate_shares(survey_sept, "Q. September 2024")
combined_shares <- bind_rows(shares_levada,
shares_survey_aug,
shares_survey_feb,
shares_survey_march,
shares_survey_july,
shares_survey_sept) %>%
pivot_wider(names_from = Survey, values_from = Share) %>%
mutate(Variable = case_when(
Variable == "age_group" ~ "Age", # improve visibility
Variable == "gender" ~ "Gender",
Variable == "university_education" ~ "Education",
TRUE ~ Variable # default case to leave the variable name as it is
))
n_levada <- as.integer(nrow(levada_omnibus))
n_march <- as.integer(nrow(survey_march))
n_feb <- as.integer(nrow(survey_feb))
n_aug <- as.integer(nrow(survey_aug))
n_july <- as.integer(nrow(survey_july))
n_sept <- as.integer(nrow(survey_sept))
# observations_row <- tibble(
#   Variable = "Number of Observations",
#   `Values` = "",
#   `Levada` = n_levada,
#   `Q. August 2023` = n_aug,
#   `Q. February 2024` = n_feb,
#   `Q. March 2024` = n_march,
#   `Q. July 2024` = n_july,
#   `Q. September 2024` = n_sept
# )
#
# combined_shares <- bind_rows(combined_shares, observations_row)
#
#
# Modify column names to include number of observations
colnames(combined_shares) <- c(
"Variable",
"Values",
paste0("Levada (N=", n_levada, ")"),
paste0("Q. August 23 (N=", n_aug, ")"),
paste0("Q. February 24 (N=", n_feb, ")"),
paste0("Q. March 24 (N=", n_march, ")"),
paste0("Q. July 24 (N=", n_july, ")"),
paste0("Q. September 24 (N=", n_sept, ")")
)
kable(combined_shares, caption = "Comparison of Category Shares by Variable\\label{tab:omnibus_shares}",
align = "c",
format = "markdown")
shares_levada <- calculate_shares(levada_omnibus, "Levada")
shares_survey_march <- calculate_shares(survey_march, "Q. March 2024")
shares_survey_feb <- calculate_shares(survey_feb, "Q. February 2024")
shares_survey_aug <- calculate_shares(survey_aug, "Q. August 2023")
shares_survey_july <- calculate_shares(survey_july, "Q. July 2024")
shares_survey_sept <- calculate_shares(survey_sept, "Q. September 2024")
combined_shares <- bind_rows(shares_levada,
shares_survey_aug,
shares_survey_feb,
shares_survey_march,
shares_survey_july,
shares_survey_sept) %>%
pivot_wider(names_from = Survey, values_from = Share) %>%
mutate(Variable = case_when(
Variable == "age_group" ~ "Age", # improve visibility
Variable == "gender" ~ "Gender",
Variable == "university_education" ~ "Education",
TRUE ~ Variable # default case to leave the variable name as it is
))
n_levada <- as.integer(nrow(levada_omnibus))
n_march <- as.integer(nrow(survey_march))
n_feb <- as.integer(nrow(survey_feb))
n_aug <- as.integer(nrow(survey_aug))
n_july <- as.integer(nrow(survey_july))
n_sept <- as.integer(nrow(survey_sept))
# observations_row <- tibble(
#   Variable = "Number of Observations",
#   `Values` = "",
#   `Levada` = n_levada,
#   `Q. August 2023` = n_aug,
#   `Q. February 2024` = n_feb,
#   `Q. March 2024` = n_march,
#   `Q. July 2024` = n_july,
#   `Q. September 2024` = n_sept
# )
#
# combined_shares <- bind_rows(combined_shares, observations_row)
#
#
# Modify column names to include number of observations
colnames(combined_shares) <- c(
"Variable",
"Values",
paste0("Levada (N=", n_levada, ")"),
paste0("Q. Aug 23 (N=", n_aug, ")"),
paste0("Q. Feb 24 (N=", n_feb, ")"),
paste0("Q. March 24 (N=", n_march, ")"),
paste0("Q. July 24 (N=", n_july, ")"),
paste0("Q. Sept 24 (N=", n_sept, ")")
)
kable(combined_shares, caption = "Comparison of Category Shares by Variable\\label{tab:omnibus_shares}",
align = "c",
format = "markdown")%>%
kable_styling(full_width = F) %>%
column_spec(1, width = "5cm") %>%  # Increase width of the first column (Variable)
column_spec(2, width = "5cm")
knitr::opts_chunk$set(echo = FALSE,
warning = FALSE,
message = FALSE,
results = 'asis')
Sys.getlocale()
# Set this to a locale that supports Cyrillic, for example, on Windows
Sys.setlocale("LC_ALL", "Russian")
##### Set Up #####
pacman::p_load(tidyverse, readr, broom,
lubridate, gt, gtsummary, survey, readxl,
gridExtra, knitr, haven, nnet, stargazer, kableExtra)
# categories for education
uni_education <- c("Высшее образование (магистратура)",
"Высшее образование (бакалавриат / специалитет)",
"Научная степень (кандидат, доктор наук)")
na_education <- c("Затрудняюсь ответить", "Отказ от ответа", "no_answer")
# load levada data
levada_omnibus <- read_sav("data/surveys/levada_omnibus") %>%
mutate(gender = fct_recode(as.factor(qS1),
"Man"= "1",
"Woman" = "2"),
#adjust age
age_group = case_when(
as.numeric(qS2) %in% c(18:24) ~ '18-24',
as.numeric(qS2) %in% c(25:34) ~ '25-34',
as.numeric(qS2) %in% c(35:44) ~ '35-44',
as.numeric(qS2) %in% c(45:54) ~ '45-54',
as.numeric(qS2) %in% c(55:64) ~ '55-64',
as.numeric(qS2) >= 65 ~ '65+',
TRUE ~ NA)
)
# load survey data
survey_march <- read_csv("data/surveys/survey_march_post_election.csv",
locale = locale(encoding = "UTF-8")) %>%
mutate(gender = fct_recode(Q4,
"Man"= "Мужской",
"Woman" = "Женский"),
#adjust age
age_group = case_when(
as.numeric(Q1) %in% c(18:24) ~ '18-24',
as.numeric(Q1) %in% c(25:34) ~ '25-34',
as.numeric(Q1) %in% c(35:44) ~ '35-44',
as.numeric(Q1) %in% c(45:54) ~ '45-54',
as.numeric(Q1) %in% c(55:64) ~ '55-64',
as.numeric(Q1) >= 65 ~ '65+',
TRUE ~ NA),
university_education = case_when(Q5 %in% uni_education ~ "BA+",
TRUE ~ "BA-")
)
survey_feb <- read_xlsx("data/surveys/survey_feb.xlsx")
# clean data
column_descriptions <- as.character(unlist(survey_feb[1, ]))
names(column_descriptions) <- names(survey_feb)
# example, call: column_descriptions["Q1"]
# remove first row
survey_feb <- survey_feb[-1,]
survey_feb <- survey_feb %>%
mutate(
gender = as.factor(Q4),
# adjust dates
StartDate = as.POSIXct((as.numeric(StartDate) - 25569) * 86400, origin = "1970-01-01", tz = "UTC"),
EndDate = as.POSIXct((as.numeric(EndDate) - 25569) * 86400, origin = "1970-01-01", tz = "UTC"),
RecordedDate = as.POSIXct((as.numeric(RecordedDate) - 25569) * 86400, origin = "1970-01-01", tz = "UTC"),
# adjust education
# Q5 %in% na_education ~ "NA" (incude to count NAs)
university_education = case_when(Q5 %in% uni_education ~ "BA+",
TRUE ~ "BA-"),
gender = fct_recode(gender,
"Man"= "Мужской",
"Woman" = "Женский"),
#adjust age
age_group = case_when(
as.numeric(Q1) %in% c(18:24) ~ '18-24',
as.numeric(Q1) %in% c(25:34) ~ '25-34',
as.numeric(Q1) %in% c(35:44) ~ '35-44',
as.numeric(Q1) %in% c(45:54) ~ '45-54',
as.numeric(Q1) %in% c(55:64) ~ '55-64',
as.numeric(Q1) >= 65 ~ '65+',
TRUE ~ NA),
# pull list experiment into one variable
list_treatment = case_when(is.na(`Q14 - version 2`) ~ 0,
TRUE ~ 1),
list_count = coalesce(`Q14 - version 1`,
`Q14 - version 2`),
# pull framing experiment into one variable
frame_treatment = case_when(
`Q15 - Group 1` != 0 ~ "Group 1",
`Q15 - Group 2` != 0 ~ "Group 2",
`Q15 - Group 3` != 0 ~ "Group 3",
`Q15 - Group 4` != 0 ~ "Group 4",
`Q15 - Group 5` != 0 ~ "Group 5",
`Q15 - Group 6` != 0 ~ "Group 6",
`Q15 - Group 7` != 0 ~ "Group 7",
`Q15 - Group 8` != 0 ~ "Group 8",
TRUE ~ NA_character_
)
,
Q15 = coalesce(`Q15 - Group 1`, `Q15 - Group 2`, `Q15 - Group 3`, `Q15 - Group 4`,
`Q15 - Group 5`, `Q15 - Group 6`, `Q15 - Group 7`, `Q15 - Group 8`)
)
# load population frame minus rows containing information on underaged categories and redundant total categories
survey_aug <- read_csv("data/surveys/survey_aug.csv",
locale = locale(encoding = "UTF-8")) %>%
# adjust education
# education %in% na_education ~ "NA"
filter(gender != "no_answer") %>%
mutate(university_education = case_when(
education %in% uni_education ~ "BA+",
TRUE ~ "BA-"),
gender = fct_recode(gender,
"Man"= "Мужской",
"Woman" = "Женский")
)
# -c(1:3,16:18)
survey_july <- read_xlsx("data/surveys/survey_june_july.xlsx")[-1,] %>%
# adjust education
# education %in% na_education ~ "NA"
mutate(university_education = case_when(
Q5 %in% uni_education ~ "BA+",
TRUE ~ "BA-"),
gender = fct_recode(Q4,
"Man"= "Мужской",
"Woman" = "Женский"),
age = as.numeric(Q1),
age_group = case_when(
as.numeric(Q1) %in% c(18:24) ~ '18-24',
as.numeric(Q1) %in% c(25:34) ~ '25-34',
as.numeric(Q1) %in% c(35:44) ~ '35-44',
as.numeric(Q1) %in% c(45:54) ~ '45-54',
as.numeric(Q1) %in% c(55:64) ~ '55-64',
as.numeric(Q1) >= 65 ~ '65+',
TRUE ~ NA),
)
survey_sept <- read_xlsx("data/surveys/survey_sept_24.xlsx")
# clean data
column_descriptions <- as.character(unlist(survey_feb[1, ]))
names(column_descriptions) <- names(survey_feb)
# example, call: column_descriptions["Q1"]
# remove first row
survey_sept <- survey_sept[-1,]
survey_sept <- survey_sept %>%
mutate(university_education = case_when(
Q5 %in% uni_education ~ "BA+",
TRUE ~ "BA-"),
gender = fct_recode(Q4,
"Man"= "Мужской",
"Woman" = "Женский"),
age = as.numeric(Q1),
age_group = case_when(
as.numeric(Q1) %in% c(18:24) ~ '18-24',
as.numeric(Q1) %in% c(25:34) ~ '25-34',
as.numeric(Q1) %in% c(35:44) ~ '35-44',
as.numeric(Q1) %in% c(45:54) ~ '45-54',
as.numeric(Q1) %in% c(55:64) ~ '55-64',
as.numeric(Q1) >= 65 ~ '65+',
TRUE ~ NA),
)
ru_population_frame <- read_csv("data/surveys/ru_population_frame.csv")[-c(1:3,16:18), -c(3,7)]
wider_age_categories <- list(
'18-24' = c('18 – 19', '20 – 24'),
'25-34' = c('25 – 29', '30 – 34'),
'35-44' = c('35 – 39', '40 – 44'),
'45-54' = c('45 – 49', '50 – 54'),
'55-64' = c('55 – 59', '60 – 64'),
'65+' = c('65 – 69', '70 и более')
)
map_age_category <- function(age) {
for (category in names(wider_age_categories)) {
if (age %in% wider_age_categories[[category]]) {
return(category)
}
}
return(NA)
}
ru_population_frame$wider_age <- sapply(ru_population_frame$Age, map_age_category)
collapsed_df <- ru_population_frame %>%
group_by(Gender, wider_age) %>%
summarise(
`BA+` = sum(`BA+`, na.rm = TRUE),
`BA-` = sum(`BA-`, na.rm = TRUE) + sum(`NA`, na.rm = TRUE)
)
# harmonise categories
ru_population_frame <- collapsed_df %>%
mutate(Gender = fct_recode(Gender,
"Man"= "Men",
"Woman" = "Women")
) %>%
pivot_longer(
cols = c("BA+", "BA-"),
names_to = "Education",
values_to = "Count"
)
# harmonise features
colnames(ru_population_frame) <- c("gender", "age_group", "university_education",
"Freq")
# load levada data
levada_omnibus <- read_sav("data/surveys/levada_omnibus") %>%
mutate(gender = fct_recode(as.factor(qS1),
"Man"= "1",
"Woman" = "2"),
#adjust age
age_group = case_when(
as.numeric(qS2) %in% c(18:24) ~ '18-24',
as.numeric(qS2) %in% c(25:34) ~ '25-34',
as.numeric(qS2) %in% c(35:44) ~ '35-44',
as.numeric(qS2) %in% c(45:54) ~ '45-54',
as.numeric(qS2) %in% c(55:64) ~ '55-64',
as.numeric(qS2) >= 65 ~ '65+',
TRUE ~ NA),
university_education = case_when(qS3 == 6 ~ "BA+",
TRUE ~ "BA-")
)
# helper funcitons
calculate_shares <- function(dataset, dataset_name) {
dataset %>%
pivot_longer(cols = c(age_group, gender, university_education), names_to = "Variable", values_to = "Values") %>%
group_by(Variable, Values) %>%
summarise(Share = n() / nrow(dataset), .groups = 'drop') %>%
mutate(Survey = dataset_name,
Share = round(Share, 2))
}
shares_levada <- calculate_shares(levada_omnibus, "Levada")
shares_survey_march <- calculate_shares(survey_march, "Q. March 2024")
shares_survey_feb <- calculate_shares(survey_feb, "Q. February 2024")
shares_survey_aug <- calculate_shares(survey_aug, "Q. August 2023")
shares_survey_july <- calculate_shares(survey_july, "Q. July 2024")
shares_survey_sept <- calculate_shares(survey_sept, "Q. September 2024")
combined_shares <- bind_rows(shares_levada,
shares_survey_aug,
shares_survey_feb,
shares_survey_march,
shares_survey_july,
shares_survey_sept) %>%
pivot_wider(names_from = Survey, values_from = Share) %>%
mutate(Variable = case_when(
Variable == "age_group" ~ "Age", # improve visibility
Variable == "gender" ~ "Gender",
Variable == "university_education" ~ "Education",
TRUE ~ Variable # default case to leave the variable name as it is
))
n_levada <- as.integer(nrow(levada_omnibus))
n_march <- as.integer(nrow(survey_march))
n_feb <- as.integer(nrow(survey_feb))
n_aug <- as.integer(nrow(survey_aug))
n_july <- as.integer(nrow(survey_july))
n_sept <- as.integer(nrow(survey_sept))
# observations_row <- tibble(
#   Variable = "Number of Observations",
#   `Values` = "",
#   `Levada` = n_levada,
#   `Q. August 2023` = n_aug,
#   `Q. February 2024` = n_feb,
#   `Q. March 2024` = n_march,
#   `Q. July 2024` = n_july,
#   `Q. September 2024` = n_sept
# )
#
# combined_shares <- bind_rows(combined_shares, observations_row)
#
#
# Modify column names to include number of observations
colnames(combined_shares) <- c(
"Variable",
"Values",
paste0("Levada (N=", n_levada, ")"),
paste0("Q. Aug 23 (N=", n_aug, ")"),
paste0("Q. Feb 24 (N=", n_feb, ")"),
paste0("Q. March 24 (N=", n_march, ")"),
paste0("Q. July 24 (N=", n_july, ")"),
paste0("Q. Sept 24 (N=", n_sept, ")")
)
kable(combined_shares, caption = "Comparison of Category Shares by Variable\\label{tab:omnibus_shares}",
align = "c",
format = "markdown")%>%
kable_styling(full_width = F) %>%
column_spec(1, width = "5cm") %>%  # Increase width of the first column (Variable)
column_spec(2, width = "5cm")
shares_levada <- calculate_shares(levada_omnibus, "Levada")
shares_survey_march <- calculate_shares(survey_march, "Q. March 2024")
shares_survey_feb <- calculate_shares(survey_feb, "Q. February 2024")
shares_survey_aug <- calculate_shares(survey_aug, "Q. August 2023")
shares_survey_july <- calculate_shares(survey_july, "Q. July 2024")
shares_survey_sept <- calculate_shares(survey_sept, "Q. September 2024")
combined_shares <- bind_rows(shares_levada,
shares_survey_aug,
shares_survey_feb,
shares_survey_march,
shares_survey_july,
shares_survey_sept) %>%
pivot_wider(names_from = Survey, values_from = Share) %>%
mutate(Variable = case_when(
Variable == "age_group" ~ "Age", # improve visibility
Variable == "gender" ~ "Gender",
Variable == "university_education" ~ "Education",
TRUE ~ Variable # default case to leave the variable name as it is
))
n_levada <- as.integer(nrow(levada_omnibus))
n_march <- as.integer(nrow(survey_march))
n_feb <- as.integer(nrow(survey_feb))
n_aug <- as.integer(nrow(survey_aug))
n_july <- as.integer(nrow(survey_july))
n_sept <- as.integer(nrow(survey_sept))
# observations_row <- tibble(
#   Variable = "Number of Observations",
#   `Values` = "",
#   `Levada` = n_levada,
#   `Q. August 2023` = n_aug,
#   `Q. February 2024` = n_feb,
#   `Q. March 2024` = n_march,
#   `Q. July 2024` = n_july,
#   `Q. September 2024` = n_sept
# )
#
# combined_shares <- bind_rows(combined_shares, observations_row)
#
#
# Modify column names to include number of observations
colnames(combined_shares) <- c(
"Variable",
"Values",
paste0("Levada (N=", n_levada, ")"),
paste0("Aug 23 (N=", n_aug, ")"),
paste0("Feb 24 (N=", n_feb, ")"),
paste0("March 24 (N=", n_march, ")"),
paste0("July 24 (N=", n_july, ")"),
paste0("Sept 24 (N=", n_sept, ")")
)
kable(combined_shares, caption = "Comparison of Category Shares by Variable\\label{tab:omnibus_shares}",
align = "c",
format = "markdown")%>%
kable_styling(full_width = F) %>%
column_spec(1, width = "7cm") %>%
column_spec(2, width = "7cm")
